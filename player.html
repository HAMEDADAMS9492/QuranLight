<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="referrer" content="no-referrer" />
    <title>Lecture Premium | Al-Quran</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/css/theme-variables.css" />
    <style>
      /* ======================================================== */
      /* 1. CONFIGURATION DU THÈME & RESET                        */
      /* ======================================================== */
      :root {
        --gold: #b08d57;
        --emerald-deep: #05140f;
        --emerald-light: #0d3a27;
        --text-muted: #b3b3b3;
      }

      * {
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
      }

      body {
        margin: 0;
        background: linear-gradient(
          to bottom,
          #0d3a27 0%,
          #05140f 40%,
          #000 100%
        );
        background-attachment: fixed;
        color: white;
        font-family: "Inter", sans-serif;
        height: 100dvh;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }

      /* ======================================================== */
      /* 2. CONTAINER PRINCIPAL                                   */
      /* ======================================================== */
      .player-container {
        width: 100%;
        max-width: 420px;
        height: 100dvh;
        display: flex;
        flex-direction: column;
        padding: 0 25px;
        justify-content: space-between;
      }

      /* ======================================================== */
      /* 3. HEADER                                                */
      /* ======================================================== */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: clamp(10px, 3dvh, 25px) 0;
        flex-shrink: 0;
      }

      .header i {
        font-size: 1.2rem;
        color: #ccc;
        cursor: pointer;
        padding: 5px;
      }

      .header span {
        font-size: 0.7rem;
        font-weight: 700;
        letter-spacing: 1.5px;
        text-transform: uppercase;
        color: #eee;
      }

      /* ======================================================== */
      /* 4. ALBUM ART (AGRANDI VERTICALEMENT)                     */
      /* ======================================================== */
      .art-wrapper {
        flex-grow: 1;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 0;
        padding: 10px 0; /* Ajoute un peu d'espace pour que l'image ne touche pas le header */
      }

      .album-art {
        width: 100%;
        max-width: clamp(250px, 90vw, 380px); /* Plus large */

        /* MODIFICATIONS CLÉS ICI : */
        height: auto;
        max-height: 80dvh; /* Augmente la hauteur maximale à 50% de l'écran */
        aspect-ratio: auto; /* Supprime le format carré pour laisser l'image monter */

        border-radius: 20px;
        box-shadow: 0 25px 70px rgba(0, 0, 0, 0.9);
        object-fit: cover; /* Garde les proportions de l'image sans la déformer */
        animation: scaleIn 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
      }
      /* ======================================================== */
      /* 5. INFO ZONE                                             */
      /* ======================================================== */
      .info-container {
        padding: 12px 0; /* Légèrement réduit pour gagner de l'espace */
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-shrink: 0;
      }

      .info-text {
        flex: 1;
        overflow: hidden;
        padding-right: 15px;
      }

      .info-text h1 {
        font-size: clamp(1.3rem, 5.5vw, 1.7rem);
        margin: 0;
        font-weight: 800;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .info-text p {
        margin: 3px 0 0;
        color: var(--text-muted);
        font-size: clamp(0.95rem, 4vw, 1.1rem);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .like-btn {
        font-size: 1.6rem;
        color: #1ed760;
        cursor: pointer;
      }

      /* ======================================================== */
      /* 6. CONTROLS                                              */
      /* ======================================================== */
      .controls-wrapper {
        flex-shrink: 0;
        width: 100%;
      }

      #progress-range {
        width: 100%;
        -webkit-appearance: none;
        background: rgba(255, 255, 255, 0.15);
        height: 5px;
        border-radius: 10px;
        outline: none;
        cursor: pointer;
      }

      #progress-range::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 14px;
        height: 14px;
        background: white;
        border-radius: 50%;
      }

      .time {
        display: flex;
        justify-content: space-between;
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 8px;
        font-weight: 500;
      }

      .main-btns {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: clamp(10px, 2.5dvh, 25px) 0 clamp(15px, 3.5dvh, 35px);
      }

      .secondary-btn {
        font-size: 1.3rem;
        color: var(--text-muted);
        padding: 10px;
      }

      .step-btn {
        font-size: 2.2rem;
        color: white;
        padding: 10px;
      }

      .play-circle {
        width: clamp(65px, 18vw, 80px); /* Cercle play légèrement plus grand */
        height: clamp(65px, 18vw, 80px);
        background: white;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: black;
        font-size: 1.7rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        transition: transform 0.2s;
      }

      .play-circle:active {
        transform: scale(0.92);
      }

      /* ======================================================== */
      /* 7. COPYRIGHT                                             */
      /* ======================================================== */
      .copyright-zone {
        text-align: center;
        padding-bottom: clamp(8px, 2dvh, 20px);
        font-size: 0.6rem;
        color: rgba(255, 255, 255, 0.25);
        letter-spacing: 2px;
        text-transform: uppercase;
        flex-shrink: 0;
      }

      /* ======================================================== */
      /* 8. ANIMATIONS & RESPONSIVE                               */
      /* ======================================================== */
      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @media (max-height: 700px) {
        .album-art {
          max-height: 30dvh;
        }
        .main-btns {
          padding: 10px 0 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="player-container">
      <header class="header">
        <i class="fas fa-chevron-down" onclick="handleBack()"></i>
        <span>Bibliotheque de lecture</span>
        <i class="fas fa-ellipsis-h"></i>
      </header>

      <div class="art-wrapper">
        <img src="" id="art" class="album-art" alt="Récitateur" />
      </div>

      <div class="info-container">
        <div class="info-text">
          <h1 id="surah-title">Chargement...</h1>
          <p id="reciter-name">Récitateur</p>
        </div>
        <i class="fas fa-check-circle like-btn"></i>
      </div>

      <div class="controls-wrapper">
        <div class="progress-container">
          <input
            type="range"
            id="progress-range"
            value="0"
            min="0"
            max="100"
            step="0.1"
          />
          <div class="time">
            <span id="current">0:00</span>
            <span id="duration">0:00</span>
          </div>
        </div>

        <div class="main-btns">
          <i class="fas fa-random secondary-btn"></i>
          <i class="fas fa-step-backward step-btn" id="prev-btn"></i>
          <div class="play-circle" id="play-btn">
            <i class="fas fa-play" id="play-icon"></i>
          </div>
          <i class="fas fa-step-forward step-btn" id="next-btn"></i>
          <i class="fas fa-redo-alt secondary-btn"></i>
        </div>
      </div>

      <div class="copyright-zone">&copy; QuranLight</div>
    </div>

    <audio id="main-audio"></audio>

    <script>
      const audio = document.getElementById("main-audio");
      const playBtn = document.getElementById("play-btn");
      const playIcon = document.getElementById("play-icon");
      const progress = document.getElementById("progress-range");
      const currentTimeEl = document.getElementById("current");
      const durationTimeEl = document.getElementById("duration");
      const nextBtn = document.getElementById("next-btn");
      const prevBtn = document.getElementById("prev-btn");

      const surahNames = [
        "Al-Fatihah",
        "Al-Baqarah",
        "Al-Imran",
        "An-Nisa",
        "Al-Ma'idah",
        "Al-An'am",
        "Al-A'raf",
        "Al-Anfal",
        "At-Tawbah",
        "Yunus",
        "Hud",
        "Yusuf",
        "Ar-Ra'd",
        "Ibrahim",
        "Al-Hijr",
        "An-Nahl",
        "Al-Isra",
        "Al-Kahf",
        "Maryam",
        "Ta-Ha",
        "Al-Anbiya",
        "Al-Hajj",
        "Al-Mu'minun",
        "An-Nur",
        "Al-Furqan",
        "Ash-Shu'ara",
        "An-Naml",
        "Al-Qasas",
        "Al-Ankabut",
        "Ar-Rum",
        "Luqman",
        "As-Sajdah",
        "Al-Ahzab",
        "Saba",
        "Fatir",
        "Ya-Sin",
        "As-Saffat",
        "Sad",
        "Az-Zumar",
        "Ghafir",
        "Fussilat",
        "Ash-Shura",
        "Az-Zukhruf",
        "Ad-Dukhan",
        "Al-Jathiyah",
        "Al-Ahqaf",
        "Muhammad",
        "Al-Fath",
        "Al-Hujurat",
        "Qaf",
        "Adh-Dhariyat",
        "At-Tur",
        "An-Najm",
        "Al-Qamar",
        "Ar-Rahman",
        "Al-Waqi'ah",
        "Al-Hadid",
        "Al-Mujadilah",
        "Al-Hashr",
        "Al-Mumtahanah",
        "As-Saff",
        "Al-Jumu'ah",
        "Al-Munafiqun",
        "At-Taghabun",
        "At-Talaq",
        "At-Tahrim",
        "Al-Mulk",
        "Al-Qalam",
        "Al-Haqqah",
        "Al-Ma'arij",
        "Nuh",
        "Al-Jinn",
        "Al-Muzzammil",
        "Al-Muddaththir",
        "Al-Qiyamah",
        "Al-Insan",
        "Al-Mursalat",
        "An-Naba",
        "An-Nazi'at",
        "Abasa",
        "At-Takwir",
        "Al-Infitar",
        "Al-Mutaffifin",
        "Al-Inshiqaq",
        "Al-Buruj",
        "At-Tariq",
        "Al-A'la",
        "Al-Ghashiyah",
        "Al-Fajr",
        "Al-Balad",
        "Ash-Shams",
        "Al-Layl",
        "Ad-Duha",
        "Ash-Sharh",
        "At-Tin",
        "Al-Alaq",
        "Al-Qadr",
        "Al-Bayyinah",
        "Az-Zalzalah",
        "Al-Adiyat",
        "Al-Qari'ah",
        "At-Takathur",
        "Al-Asr",
        "Al-Humazah",
        "Al-Fil",
        "Quraysh",
        "Al-Ma'un",
        "Al-Kawthar",
        "Al-Kafirun",
        "An-Nasr",
        "Al-Masad",
        "Al-Ikhlas",
        "Al-Falaq",
        "An-Nas",
      ];

      window.onload = () => {
        loadTrack();
      };

      function loadTrack() {
        const url = localStorage.getItem("player_url");
        const artist = localStorage.getItem("player_artist");
        const img = localStorage.getItem("player_img");
        const num = parseInt(localStorage.getItem("currentSurahNum") || "1");

        if (url) {
          // Utilisation du tableau surahNames (assurez-vous qu'il est défini globalement)
          document.getElementById("surah-title").innerText = `${num}. ${
            surahNames[num - 1]
          }`;
          document.getElementById("reciter-name").innerText = artist;
          document.getElementById("art").src =
            img || "assets/image/default-quran.jpg";
          audio.src = url;
          audio
            .play()
            .catch((e) => console.log("Lecture auto bloquée ou erreur source"));
          updateUI();
        }
      }

      playBtn.addEventListener("click", () => {
        audio.paused ? audio.play() : audio.pause();
        updateUI();
      });

      function updateUI() {
        if (audio.paused) {
          playIcon.className = "fas fa-play";
          playIcon.style.transform = "translateX(2px)";
        } else {
          playIcon.className = "fas fa-pause";
          playIcon.style.transform = "translateX(0px)";
        }
      }

      audio.addEventListener("timeupdate", () => {
        if (!isNaN(audio.duration)) {
          const percent = (audio.currentTime / audio.duration) * 100;
          progress.value = percent;
          progress.style.background = `linear-gradient(to right, white ${percent}%, rgba(255,255,255,0.2) ${percent}%)`;
          currentTimeEl.innerText = formatTime(audio.currentTime);
          durationTimeEl.innerText = formatTime(audio.duration);
        }
      });

      progress.addEventListener("input", () => {
        const seekTime = (progress.value / 100) * audio.duration;
        audio.currentTime = seekTime;
      });

      function formatTime(seconds) {
        const min = Math.floor(seconds / 60);
        const sec = Math.floor(seconds % 60);
        return `${min}:${sec < 10 ? "0" + sec : sec}`;
      }

      nextBtn.onclick = () => changeSurah(1);
      prevBtn.onclick = () => changeSurah(-1);

      function changeSurah(dir) {
        let currentNum = parseInt(
          localStorage.getItem("currentSurahNum") || "1"
        );
        let reciterId = localStorage.getItem("currentReciterId");
        let newNum = currentNum + dir;

        // Limites de l'index des sourates (1 à 114)
        if (newNum >= 1 && newNum <= 114) {
          const padded = newNum.toString().padStart(3, "0");
          let newUrl = "";

          // LOGIQUE DE NAVIGATION DES SERVEURS (Version corrigée pour Afif Taj)
          if (reciterId === "ar.afifmuhammadtaj") {
            // Correction du dossier : afif_mohammad_taj (avec un 'o')
            newUrl = `https://download.quranic.audio/quran/afif_mohammad_taj/${padded}.mp3`;
          } else if (reciterId === "ar.abdulbasitmurattal") {
            newUrl = `https://server7.mp3quran.net/basit/murattal/${padded}.mp3`;
          } else if (reciterId === "ar.sudais") {
            newUrl = `https://server11.mp3quran.net/sds/${padded}.mp3`;
          } else if (reciterId === "ar.alafasy") {
            newUrl = `https://server8.mp3quran.net/afs/${padded}.mp3`;
          } else if (reciterId === "ar.hanirifai") {
            newUrl = `https://server8.mp3quran.net/hani/${padded}.mp3`;
          } else if (reciterId === "ar.shatri") {
            newUrl = `https://server11.mp3quran.net/shatri/${padded}.mp3`;
          } else {
            // Fallback pour les autres récitateurs via l'API Islamic Network
            newUrl = `https://cdn.islamic.network/quran/audio-surah/128/${reciterId}/${newNum}.mp3`;
          }
          localStorage.setItem("player_url", newUrl);
          localStorage.setItem("currentSurahNum", newNum);
          loadTrack();
        }
      }

      audio.onended = () => changeSurah(1);

      function handleBack() {
        document.body.style.opacity = "0";
        setTimeout(() => window.history.back(), 300);
      }
    </script>
    <script src="assets/js/theme-loader.js"></script>
  </body>
</html>
