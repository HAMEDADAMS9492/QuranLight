<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Récitateurs | Al-Quran Premium</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Amiri&family=Inter:wght@400;700;900&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --color-gold: #b08d57;
        --color-gold-light: #d4bc96;
        --color-emerald-deep: #05140f;
        --color-emerald-light: #0d3a27;
        --transition: all 0.4s cubic-bezier(0.2, 1, 0.3, 1);
      }

      /* Reset & Scrollbar */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        -webkit-tap-highlight-color: transparent;
      }
      ::-webkit-scrollbar {
        display: none;
      }

      body {
        font-family: "Inter", sans-serif;
        background: #05140f;
        color: #ffffff;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* --- HEADER --- */
      .reciters-header {
        position: sticky;
        top: 0;
        z-index: 1000;
        background: rgba(5, 20, 15, 0.95);
        backdrop-filter: blur(15px);
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        border-bottom: 1px solid rgba(176, 141, 87, 0.2);
      }

      .back-btn {
        color: var(--color-gold);
        font-size: 1.3rem;
        cursor: pointer;
      }

      .header-title {
        text-align: center;
        flex-grow: 1;
      }
      .header-title h1 {
        font-size: 1rem;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 2px;
        color: #fff;
      }

      /* --- RECHERCHE ÉLARGIE --- */
      .search-wrapper {
        padding: 15px 20px;
        width: 100%;
        max-width: 100%;
      }
      .search-box {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(176, 141, 87, 0.3);
        border-radius: 12px;
        padding: 12px 15px;
        display: flex;
        align-items: center;
      }
      .search-box input {
        background: transparent;
        border: none;
        color: white;
        font-size: 0.95rem;
        width: 100%;
        outline: none;
      }

      /* --- LISTE RÉCITATEURS --- */
      .reciters-container {
        width: 100%;
        padding: 0 20px 100px;
        display: grid;
        gap: 10px;
      }

      .reciter-card-premium {
        display: flex;
        align-items: center;
        padding: 15px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        cursor: pointer;
        transition: var(--transition);
      }
      .reciter-card-premium:hover {
        background: rgba(176, 141, 87, 0.1);
        border-color: var(--color-gold);
      }

      .reciter-avatar-box {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        margin-right: 15px;
        flex-shrink: 0;
        overflow: hidden;
        border: 1px solid var(--color-gold);
      }
      .reciter-avatar-box img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .reciter-meta {
        flex-grow: 1;
      }
      .name-fr {
        display: block;
        font-size: 1rem;
        font-weight: 700;
        color: #fff;
      }
      .name-ar {
        font-size: 0.9rem;
        color: var(--color-gold-light);
        font-family: "Amiri", serif;
      }

      /* --- MODAL SOURATES --- */
      #surahPanel {
        position: fixed;
        inset: 0;
        background: #05140f;
        z-index: 2000;
        display: none;
        flex-direction: column;
      }

      .surah-list {
        overflow-y: auto;
        padding: 0 20px 100px;
        width: 100%;
      }

      .surah-item {
        padding: 15px;
        margin-bottom: 8px;
        background: rgba(255, 255, 255, 0.03);
        border: 1px solid rgba(255, 255, 255, 0.05);
        border-radius: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
      }
      .surah-item:hover {
        border-color: var(--color-gold);
        background: rgba(176, 141, 87, 0.05);
      }

      .surah-num {
        width: 35px;
        height: 35px;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--color-gold-light);
        font-size: 0.75rem;
        font-weight: 800;
        margin-right: 15px;
      }

      .surah-name-en {
        color: #fff;
        font-weight: 600;
        font-size: 0.95rem;
      }
      .surah-name-ar {
        color: var(--color-gold-light);
        font-family: "Amiri", serif;
        font-size: 1.1rem;
      }
    </style>
  </head>
  <body>
    <header class="reciters-header">
      <div class="back-btn" onclick="window.location.href='index.html'">
        <i class="fas fa-arrow-left"></i>
      </div>
      <div class="header-title"><h1>Bibliothèque</h1></div>
      <div style="width: 40px"></div>
    </header>

    <div class="search-wrapper">
      <div class="search-box">
        <i
          class="fas fa-search"
          style="color: var(--color-gold); margin-right: 10px"
        ></i>
        <input
          type="text"
          id="searchInput"
          placeholder="Chercher un récitateur..."
          onkeyup="filterReciters()"
        />
      </div>
    </div>

    <main class="reciters-container" id="recitersList"></main>

    <div id="surahPanel">
      <header class="reciters-header">
        <div class="back-btn" onclick="closePanel()">
          <i class="fas fa-times"></i>
        </div>
        <div class="header-title"><h1 id="selectedName">Chargement...</h1></div>
        <div style="width: 40px"></div>
      </header>

      <div class="search-wrapper">
        <div class="search-box">
          <input
            type="text"
            id="surahSearchInput"
            placeholder="Chercher une sourate..."
            onkeyup="filterSurahs()"
          />
        </div>
      </div>

      <div class="surah-list" id="surahContent"></div>
    </div>

    <script>
      const recitersData = [
        {
          id: "ar.abdulbasitmurattal",
          name: "Abd Al-Basit",
          ar: "عبد الباسط عبد الصمد",
          img: "assets/image/basit.jpg",
        },
        {
          id: "ar.sudais",
          name: "Al-Sudais",
          ar: "عبد الرحمن السديس",
          img: "assets/image/sudais.jpg",
        },
        {
          id: "ar.hanirifai",
          name: "Hani Al-Rifai",
          ar: "هاني الرفاعي",
          img: "assets/image/hani.jpg",
        },
        {
          id: "ar.alafasy",
          name: "Mishary Alafasy",
          ar: "مشاري العفاسي",
          img: "assets/image/mishary.jpg",
        },
        {
          id: "ar.basfar",
          name: "Abdullah Basfar",
          ar: "عبد الله بصفر",
          img: "assets/image/basfar.jpg",
        },
        {
          id: "ar.shatri",
          name: "Abu Bakr Al-Shatri",
          ar: "أبو بكر الشاطري",
          img: "assets/image/shatri.jpg",
        },
      ];

      let allSurahs = [];
      let currentReciter = {};

      window.onload = () => {
        renderReciters(recitersData);
        // Vérification si un récitateur a été pré-sélectionné
        const tId = localStorage.getItem("targetReciterId");
        const tNm = localStorage.getItem("targetReciterName");
        if (tId && tNm) {
          openSurahs(tId, tNm);
          localStorage.removeItem("targetReciterId");
          localStorage.removeItem("targetReciterName");
        }
      };

      function renderReciters(list) {
        const container = document.getElementById("recitersList");
        container.innerHTML = list
          .map(
            (r) => `
            <div class="reciter-card-premium" onclick="openSurahs('${r.id}', '${r.name}')">
                <div class="reciter-avatar-box">
                    <img src="${r.img}" alt="${r.name}" onerror="this.src='https://ui-avatars.com/api/?name=${r.name}&background=0d3a27&color=b08d57'">
                </div>
                <div class="reciter-meta">
                    <span class="name-fr">${r.name}</span>
                    <span class="name-ar">${r.ar}</span>
                </div>
                <i class="fas fa-chevron-right" style="color: var(--color-gold); opacity: 0.5;"></i>
            </div>
        `
          )
          .join("");
      }

      async function openSurahs(id, name) {
        currentReciter = { id, name };
        document.getElementById("selectedName").innerText = name;
        document.getElementById("surahPanel").style.display = "flex";

        const content = document.getElementById("surahContent");
        content.innerHTML =
          '<div style="text-align:center; padding:50px;"><i class="fas fa-spinner fa-spin fa-2x" style="color:var(--color-gold)"></i></div>';

        try {
          if (allSurahs.length === 0) {
            const res = await fetch("https://api.alquran.cloud/v1/surah");
            const data = await res.json();
            allSurahs = data.data;
          }
          displaySurahs(allSurahs);
        } catch (e) {
          content.innerHTML =
            "<p style='text-align:center; padding:20px;'>Erreur de connexion.</p>";
        }
      }

      function displaySurahs(list) {
        const content = document.getElementById("surahContent");
        content.innerHTML = list
          .map(
            (s) => `
            <div class="surah-item" onclick="selectAudio('${
              currentReciter.id
            }', ${s.number}, '${currentReciter.name}', '${s.englishName.replace(
              /'/g,
              "\\'"
            )}')">
                <div style="display:flex; align-items:center;">
                    <div class="surah-num">${s.number}</div>
                    <span class="surah-name-en">${s.englishName}</span>
                </div>
                <span class="surah-name-ar">${s.name}</span>
            </div>
        `
          )
          .join("");
      }

      function filterReciters() {
        const query = document
          .getElementById("searchInput")
          .value.toLowerCase();
        const filtered = recitersData.filter(
          (r) => r.name.toLowerCase().includes(query) || r.ar.includes(query)
        );
        renderReciters(filtered);
      }

      function filterSurahs() {
        const query = document
          .getElementById("surahSearchInput")
          .value.toLowerCase();
        const filtered = allSurahs.filter(
          (s) =>
            s.englishName.toLowerCase().includes(query) ||
            s.number.toString().includes(query)
        );
        displaySurahs(filtered);
      }

      // --- LOGIQUE DE LECTURE VERS PLAYER.HTML ---
      function selectAudio(reciterId, surahNum, reciterName, surahName) {
        const padded = surahNum.toString().padStart(3, "0");
        let audioUrl = "";

        // Même logique de serveur que sur l'index
        const servers = {
          "ar.abdulbasitmurattal":
            "https://server7.mp3quran.net/basit/murattal",
          "ar.sudais": "https://server11.mp3quran.net/sds",
          "ar.alafasy": "https://server8.mp3quran.net/afs",
          "ar.hanirifai": "https://server8.mp3quran.net/hani",
          "ar.shatri": "https://server11.mp3quran.net/shatri",
          "ar.basfar": "https://server6.mp3quran.net/bsfr",
        };

        if (servers[reciterId]) {
          audioUrl = `${servers[reciterId]}/${padded}.mp3`;
        } else {
          audioUrl = `https://cdn.islamic.network/quran/audio-surah/128/${reciterId}/${surahNum}.mp3`;
        }

        // Trouver l'image du récitateur
        const reciterInfo = recitersData.find((r) => r.id === reciterId);
        const reciterImg = reciterInfo
          ? reciterInfo.img
          : "assets/image/default-quran.jpg";

        // Stockage des infos pour player.html
        localStorage.setItem("player_url", audioUrl);
        localStorage.setItem("player_title", surahName);
        localStorage.setItem("player_artist", reciterName);
        localStorage.setItem("player_img", reciterImg);

        localStorage.setItem("currentReciterId", reciterId);
        localStorage.setItem("currentReciterName", reciterName);
        localStorage.setItem("currentSurahNum", surahNum);

        // Redirection directe
        window.location.href = "player.html";
      }

      function closePanel() {
        document.getElementById("surahPanel").style.display = "none";
        document.getElementById("surahSearchInput").value = "";
      }
    </script>

    <script src="script.js"></script>
  </body>
</html>
